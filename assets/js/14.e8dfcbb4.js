(window.webpackJsonp=window.webpackJsonp||[]).push([[14],{247:function(s,a,n){"use strict";n.r(a);var t=n(2),e=Object(t.a)({},(function(){var s=this,a=s.$createElement,n=s._self._c||a;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("div",{staticClass:"custom-block tip"},[n("p",[s._v("前言：DockerFile分为四部分组成："),n("strong",[s._v("基础镜像信")]),s._v("、"),n("strong",[s._v("维护者信息")]),s._v("、"),n("strong",[s._v("镜像操作指令")]),s._v("和"),n("strong",[s._v("容器启动时执行指令")]),s._v("。")])]),s._v(" "),n("h1",{attrs:{id:"dockerfile-从无到有创建镜像"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#dockerfile-从无到有创建镜像"}},[s._v("#")]),s._v(" Dockerfile-从无到有创建镜像")]),s._v(" "),n("h1",{attrs:{id:"结构"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#结构"}},[s._v("#")]),s._v(" 结构")]),s._v(" "),n("h4",{attrs:{id:"第一行必须指令基于的基础镜像"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#第一行必须指令基于的基础镜像"}},[s._v("#")]),s._v(" 第一行必须指令基于的基础镜像")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("FROM  docker.io/sitoi/openshift-spark:2.2.0\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("h4",{attrs:{id:"维护者信息"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#维护者信息"}},[s._v("#")]),s._v(" 维护者信息")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("MAINTAINER Shi Tao "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("shitao@sinocbd.com"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("h4",{attrs:{id:"镜像的操作指令"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#镜像的操作指令"}},[s._v("#")]),s._v(" 镜像的操作指令")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("ENV "),n("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("HOME")]),s._v(" /app\nENV "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[n("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("LOGNAME")])]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("root\nENV "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[n("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("USER")])]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("root\nENV "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("LD_LIBRARY_PATH")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/opt/oracle/instantclient_12_2:"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$LD_LIBRARY_PATH")]),s._v("\nENV "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("PYSPARK_PYTHON")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("python3\nADD "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v(" /app/\n\nRUN "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" /root/.ivy2 "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("mv")]),s._v(" /usr/share/java/mysql-connector-java.jar /opt/spark/jars/ "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("mv")]),s._v(" /app/mongo-spark-connector_2.11-2.2.1.jar /opt/spark/jars/ "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("mv")]),s._v(" /app/mongo-java-driver-3.4.2.jar /opt/spark/jars/ "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("mv")]),s._v(" /app/neo4j-spark-connector_2.11-1.0.0-RC1.jar /opt/spark/jars/ "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("mv")]),s._v(" /app/ojdbc6.jar /opt/spark/jars/ "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("mv")]),s._v(" /app/sqljdbc42.jar /opt/spark/jars/ "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("mv")]),s._v(" /app/mysql-connector-java-5.1.45-bin.jar /opt/spark/jars/ "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" /opt/oracle "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt-get")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("unzip")]),s._v(" libaio1 python3-pymssql -y "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("unzip")]),s._v(" instantclient-basiclite-linux.x64-12.2.0.1.0.zip -d /opt/oracle "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" instantclient-basiclite-linux.x64-12.2.0.1.0.zip "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sh")]),s._v(" -c "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"echo /opt/oracle/instantclient_12_2 > /etc/ld.so.conf.d/oracle-instantclient.conf"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    ldconfig "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" -p /opt/oracle/instantclient_12_2/network/admin "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" a+x /app/bootstrap.sh "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    pip3 "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" -r requirements.txt --upgrade\n\n\nENTRYPOINT "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/entrypoint"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br")])]),n("h4",{attrs:{id:"容器启动时执行指令"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#容器启动时执行指令"}},[s._v("#")]),s._v(" 容器启动时执行指令")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("CMD "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/app/bootstrap.sh"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("h3",{attrs:{id:"指令"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#指令"}},[s._v("#")]),s._v(" 指令")]),s._v(" "),n("h4",{attrs:{id:"from指令"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#from指令"}},[s._v("#")]),s._v(" From指令")]),s._v(" "),n("p",[n("em",[s._v("From")]),s._v("或者"),n("em",[s._v("Ｆrom：")])]),s._v(" "),n("p",[s._v("DockerFile 第一条必须为 From 指令。如果同一个 DockerFile 创建多个镜像时，可使用多个 From 指令（每个镜像一次）")]),s._v(" "),n("h5",{attrs:{id:"样例"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#样例"}},[s._v("#")]),s._v(" "),n("strong",[s._v("样例")])]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("FROM docker.io/jcdemo/flaskapp\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("h4",{attrs:{id:"maintainer"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#maintainer"}},[s._v("#")]),s._v(" MAINTAINER")]),s._v(" "),n("p",[s._v("格式为："),n("em",[s._v("maintainer")]),s._v("，指定维护者的信息")]),s._v(" "),n("p",[n("strong",[s._v("样例")])]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("MAINTAINER Zhang Feng "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("zf@zylliondata.com"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("h4",{attrs:{id:"run"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#run"}},[s._v("#")]),s._v(" RUN")]),s._v(" "),n("p",[s._v("格式为 "),n("code",[s._v("Run")]),s._v(" 在 "),n("code",[s._v("shell")]),s._v(" 终端上运行，即 "),n("code",[s._v("/bin/sh -C")]),s._v(" 每条 "),n("code",[s._v("run")]),s._v(" 指令在当前基础镜像执行，并且提交新镜像。当命令比较长时，可以使用 “/” 换行。")]),s._v(" "),n("h4",{attrs:{id:"cmd-指令"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#cmd-指令"}},[s._v("#")]),s._v(" CMD 指令")]),s._v(" "),n("p",[s._v("支持三种格式：")]),s._v(" "),n("p",[n("code",[s._v("CMD [“executable” ,”Param1”, “param2”]")]),s._v(" 使用 "),n("code",[s._v("exec")]),s._v("执行，"),n("strong",[s._v("推荐")])]),s._v(" "),n("p",[n("code",[s._v("CMD command param1 param2")]),s._v("，在 "),n("code",[s._v("/bin/sh")]),s._v(" 上执行")]),s._v(" "),n("p",[n("code",[s._v("CMD [“Param1”, “param2”]")]),s._v(" 提供给 "),n("code",[s._v("ENTRYPOINT")]),s._v(" 做默认参数")]),s._v(" "),n("p",[s._v("每个容器只能执行一条CMD命令，多个CMD命令时，"),n("code",[s._v("只最后一条被执行")])]),s._v(" "),n("h4",{attrs:{id:"expose"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#expose"}},[s._v("#")]),s._v(" EXPOSE")]),s._v(" "),n("p",[s._v("格式为 "),n("code",[s._v("EXPOSE […]")])]),s._v(" "),n("p",[s._v("告诉 Docker 服务端容器暴露的端口号，供互联系统使用。在启动 Docker 时，可以通过 -P,主机会自动分配一个端口号转发到指定的端口。使用 -P，则可以具体指定哪个本地端口映射过来")]),s._v(" "),n("p",[n("strong",[s._v("样例")])]),s._v(" "),n("p",[n("code",[s._v("EXPOSE 22 80 8443")])]),s._v(" "),n("h4",{attrs:{id:"env"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#env"}},[s._v("#")]),s._v(" ENV")]),s._v(" "),n("p",[s._v("格式为 "),n("code",[s._v("ENV")]),s._v(" 。 指定一个环境变量，会被后续 RUN 指令使用，并在容器运行时保持。")]),s._v(" "),n("p",[n("strong",[s._v("样例")])]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("ENV "),n("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("HOME")]),s._v(" /app\nENV "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[n("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("LOGNAME")])]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("root\nENV "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[n("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("USER")])]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("root\nENV "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("LD_LIBRARY_PATH")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/opt/oracle/instantclient_12_2:"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$LD_LIBRARY_PATH")]),s._v("\nENV "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("PYSPARK_PYTHON")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("python3\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("h4",{attrs:{id:"add"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#add"}},[s._v("#")]),s._v(" ADD")]),s._v(" "),n("p",[s._v("格式为 "),n("code",[s._v("ADD")]),s._v("。")]),s._v(" "),n("p",[s._v("该命令将复制指定的 到容器中的 。 其中可以是 "),n("code",[s._v("Dockerfile")]),s._v(" 所在目录的一个"),n("code",[s._v("相对路径")]),s._v("；也可以是一个 "),n("code",[s._v("URL")]),s._v("；还可以是一个 "),n("code",[s._v("tar文件（自动解压为目录）")])]),s._v(" "),n("p",[n("strong",[s._v("样例")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("ADD . /app/\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("h4",{attrs:{id:"copy"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#copy"}},[s._v("#")]),s._v(" COPY")]),s._v(" "),n("p",[s._v("格式为 "),n("code",[s._v("COPY")]),s._v(" 。")]),s._v(" "),n("p",[s._v("复制本地主机的 （为 Dockerfile 所在目录的相对路径）到容器中的 。")]),s._v(" "),n("p",[s._v("当使用本地目录为源目录时，推荐使用 "),n("code",[s._v("COPY")]),s._v("。")]),s._v(" "),n("h4",{attrs:{id:"entrypoint"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#entrypoint"}},[s._v("#")]),s._v(" ENTRYPOINT")]),s._v(" "),n("p",[s._v("两种格式：")]),s._v(" "),n("p",[n("code",[s._v("ENTRYPOINT [“executable”, “param1”, “param2”]")])]),s._v(" "),n("p",[n("code",[s._v("ENTRYPOINT command param1 param2")]),s._v(" （shell中执行）。")]),s._v(" "),n("p",[s._v("配置容器启动后执行的命令，并且不可被 docker run 提供的参数覆盖。")]),s._v(" "),n("p",[s._v("每个Dockerfile中只能有一个 ENTRYPOINT ，当指定多个时，只有最后一个起效。")]),s._v(" "),n("h4",{attrs:{id:"volume"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#volume"}},[s._v("#")]),s._v(" VOLUME")]),s._v(" "),n("p",[s._v("格式为 "),n("code",[s._v("VOLUME [“/data”]")]),s._v(" 。")]),s._v(" "),n("p",[s._v("创建一个可以从本地主机或其他容器挂载的挂载点，一般用来存放数据库和需要保持的数据等。")]),s._v(" "),n("h4",{attrs:{id:"user"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#user"}},[s._v("#")]),s._v(" USER")]),s._v(" "),n("p",[s._v("格式为 "),n("code",[s._v("USER daemon")]),s._v(" 。")]),s._v(" "),n("p",[s._v("指定运行容器时的用户名或UID，后续的 RUN 也会使用指定用户。")]),s._v(" "),n("p",[s._v("当服务不需要管理员权限时，可以通过该命令指定运行用户。并且可以在之前创建所需要的用户，")]),s._v(" "),n("p",[n("strong",[s._v("样例")])]),s._v(" "),n("p",[n("code",[s._v("RUN groupadd -r postgres && useradd -r -g postgres postgres")]),s._v(" 。")]),s._v(" "),n("p",[s._v("要临时获取管理员权限可以使用 gosu ，而不推荐 sudo 。")]),s._v(" "),n("h4",{attrs:{id:"workdir"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#workdir"}},[s._v("#")]),s._v(" WORKDIR")]),s._v(" "),n("p",[s._v("格式为 "),n("code",[s._v("WORKDIR /path/to/workdir")]),s._v(" 。")]),s._v(" "),n("p",[s._v("为后续的 RUN 、 CMD 、 ENTRYPOINT 指令配置工作目录。")]),s._v(" "),n("p",[s._v("可以使用多个 WORKDIR 指令，后续命令如果参数是相对路径，则会基于之前命令指定的路径。")]),s._v(" "),n("p",[n("strong",[s._v("样例")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("WORKDIR /a\nWORKDIR b\nWORKDIR c\nCopy\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("p",[n("code",[s._v("RUN pwd")])]),s._v(" "),n("p",[s._v("则最终路径为 /a/b/c 。")]),s._v(" "),n("h4",{attrs:{id:"onbuild"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#onbuild"}},[s._v("#")]),s._v(" ONBUILD")]),s._v(" "),n("p",[s._v("格式为 "),n("code",[s._v("ONBUILD [INSTRUCTION]")])]),s._v(" "),n("p",[s._v("配置当所创建的镜像作为其它新创建镜像的基础镜像时，所执行的操作指令。")]),s._v(" "),n("p",[s._v("例如，Dockerfile 使用如下的内容创建了镜像 image-A 。")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("[…]\nONBUILD ADD . /app/src\nONBUILD RUN /usr/local/bin/python-build –dir /app/src\n[…]\nCopy\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("p",[s._v("如果基于A创建新的镜像时，新的Dockerfile中使用 FROM image-A 指定基础镜像时，会自动执行 ONBUILD 指令内容，等价于在后面添加了两条指令。")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("FROM image-A\n\n#Automatically run the following\nADD . /app/src\nRUN /usr/local/bin/python-build --dir /app/src\nCopy\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br")])]),n("p",[s._v("使用 ONBUILD 指令的镜像，推荐在标签中注明，例如 ruby:1.9-onbuild 。")]),s._v(" "),n("h2",{attrs:{id:"创建镜像"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#创建镜像"}},[s._v("#")]),s._v(" 创建镜像")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("docker build -t 镜像名 dockerfile路径\nCopy\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("p",[n("strong",[s._v("样例")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("docker build -t myrepo/myapp /tmp/test1/\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("h2",{attrs:{id:"使用python3启动docker命令："}},[n("a",{staticClass:"header-anchor",attrs:{href:"#使用python3启动docker命令："}},[s._v("#")]),s._v(" 使用python3启动docker命令：")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("docker run -it -p 对外端口:对内端口 镜像名\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("ul",[n("li",[s._v('"Dockerfile"文件运行目录样例')])]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("ENTRYPOINT "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"python3"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nCMD "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"vidoe_downloader.py"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("h2",{attrs:{id:"使用docker-compose启动docker命令："}},[n("a",{staticClass:"header-anchor",attrs:{href:"#使用docker-compose启动docker命令："}},[s._v("#")]),s._v(" 使用docker-compose启动docker命令：")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("docker-compose up\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("ul",[n("li",[s._v('"Dockerfile"文件运行目录样例')])]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("ENTRYPOINT "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"gunicorn"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nCMD "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-b 0.0.0.0:2435"')]),s._v(", "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"vidoe_downloader:app"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("h2",{attrs:{id:"一下是一些实例"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#一下是一些实例"}},[s._v("#")]),s._v(" 一下是一些实例")]),s._v(" "),n("blockquote",[n("p",[n("code",[s._v("centos:7-node-10")]),s._v(" 打 vue 前端界面项目 dockerfile")])]),s._v(" "),n("div",{staticClass:"language-dockerfile line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('FROM registry.zylliondata.local/centos:7-node-10\n\nWORKDIR /opt/app\nENV HOME /opt/app\nADD . /opt/app\n\nRUN yum install make -y \\\n    && curl http://nexus.zylliondata.local/repository/repos/npmrc.ini > /opt/app/.npmrc \\\n    && npm install webpack-dev-server -g --registry=http://nexus.zylliondata.local/repository/npm-proxy/ \\\n    && npm install --registry=http://nexus.zylliondata.local/repository/npm-proxy/ \\\n    && npm run build --registry=http://nexus.zylliondata.local/repository/npm-proxy/ \\\n    && chown -R 1001:1001 /opt/app\n\nEXPOSE 8080\nUSER 1001\n\nENTRYPOINT ["bash", "run.sh"]\n\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br")])]),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token shebang important"}},[s._v("#!/usr/bin/env bash")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${SPRING_PROFILES_ACTIVE}")]),s._v('"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"prod"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("then")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Prod")]),s._v("\n    node server.js\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Dev")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" run serve\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fi")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br")])]),n("blockquote",[n("p",[n("code",[s._v("centos:7-python-3.6")]),s._v(" 打 Flask-Plus 接口服务项目 dockerfile")])]),s._v(" "),n("div",{staticClass:"language-dockerfile line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('FROM registry.zylliondata.local/centos:7-python-3.6\n\nLABEL io.k8s.description="爬虫任务分配（Scoring System）" \\\n    io.k8s.display-name="爬虫任务分配" \\\n    io.openshift.expose-services="8000:http" \\\n    io.openshift.tags="Scoring,idsg,ioData,d4i,flask"\n\nWORKDIR /opt/app\nENV HOME /opt/app\nADD . /opt/app\nADD localtime /etc/localtime\n\nRUN yum install cyrus-sasl-* python36u-devel gcc-c++ -y && pip3.6 install -r requirements.txt \\\n    --upgrade --index-url=https://pypi.tuna.tsinghua.edu.cn/simple \\\n    && chown -R 1001:0 /opt/app && chmod -R 777 /opt/app\n\nUSER 1001\nEXPOSE 5000\n\nENTRYPOINT ["gunicorn"]\nCMD ["-b 0.0.0.0:5000", "application:app","-k gevent","-w 4"]\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br")])]),n("blockquote",[n("p",[n("code",[s._v("centos:7-java-11")]),s._v(" Spring Boot Java 接口服务项目 dockerfile")])]),s._v(" "),n("div",{staticClass:"language-dockerfile line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('FROM registry.zylliondata.local/centos:7-java-11\nMAINTAINER Chen Boyang <chenby@zylliondata.com>\n\nWORKDIR /opt/app\nENV HOME /opt/app\nADD . /opt/app\nADD localtime /etc/localtime\n\n#RUN yum install python36u docker python36u-pip python36u-devel gcc-c++ -y \\\n#    && mkdir -p ~/.pip/ \\\n#    && curl http://nexus.zylliondata.local/repository/repos/pip.conf > ~/.pip/pip.conf \\\n#    && python3.6 -m pip install pip --upgrade \\\n#    && python3.6 -m pip install pyyaml --upgrade \\\n#    && mkdir /opt/app/.kube \\\n#    && mv kube-config.yaml /opt/app/.kube/config \\\n#    && chown -R 1001:1001 /opt/app/.kube \\\n#    && mvn -B clean package && mv target/app.jar app.jar \\\n#    && mvn -B clean && rm -rf ~/.m2/ src/ /bin/mvn /opt/apache-maven* \\\n#    && yum autoremove -y \\\n#    && chmod -R 777 /opt/app/templates \\\n#    && yum clean all && rm -rf /tmp/* && rm -rf /usr/share/doc/ && rm -rf /usr/share/man\n#\n#USER 1001\n#EXPOSE 5273\n#\n#ENTRYPOINT ["/etc/alternatives/java_sdk_11/bin/java","-jar","/opt/app/app.jar","--spring.profiles.active=prod", "--file.encoding=UTF-8"]\n\nRUN curl http://nexus.zylliondata.local/repository/res/boot-maven.sh | bash\n\nUSER 1001\nEXPOSE 5273\n\nENTRYPOINT ["bash", "/opt/app/run.sh"]\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br")])]),n("blockquote",[n("blockquote",[n("p",[s._v("其它待续。。。")])])])])}),[],!1,null,null,null);a.default=e.exports}}]);