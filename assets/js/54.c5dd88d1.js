(window.webpackJsonp=window.webpackJsonp||[]).push([[54],{252:function(s,e,a){"use strict";a.r(e);var t=a(2),n=Object(t.a)({},(function(){var s=this,e=s.$createElement,a=s._self._c||e;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("div",{staticClass:"custom-block tip"},[a("p",[s._v("前言：最近发现新大陆,一个模块mongoengine可以实现Python Model类似的封装.但是mongoengine的中文文档几乎没有,有的也是简短的几句介绍和使用.下面我就分享一下我在使用过程中所记录下的一些笔记,可能有点乱.大家可以参考一下.")]),s._v(" "),a("blockquote",[a("p",[s._v("此文献经转载修改")])])]),s._v(" "),a("h3",{attrs:{id:"安装mongoengine"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装mongoengine"}},[s._v("#")]),s._v(" 安装mongoengine")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("easy_install pymongo "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 依赖库")]),s._v("\neasy_install mongoengine\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("ul",[a("li",[a("p",[s._v("可用的运算符如下：")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("ne – 不等于≠")])]),s._v(" "),a("li",[a("p",[s._v("lt – 小于<")])]),s._v(" "),a("li",[a("p",[s._v("lte – 小于等于≤")])]),s._v(" "),a("li",[a("p",[s._v("gt – 大于>")])]),s._v(" "),a("li",[a("p",[s._v("gte – 大于等于 ≥")])]),s._v(" "),a("li",[a("p",[s._v("not – 否定一个标准的检查，需要用在其他操作符之前(e.g. Q(age__not__mod=5))")])]),s._v(" "),a("li",[a("p",[s._v("in – 值在 list 中")])]),s._v(" "),a("li",[a("p",[s._v("nin – 值不在 list 中")])]),s._v(" "),a("li",[a("p",[s._v("mod – value % x == y, 其中 x 和 y 为给定的值")])]),s._v(" "),a("li",[a("p",[s._v("all – list 里面所有的值")])]),s._v(" "),a("li",[a("p",[s._v("size – 数组的大小")])]),s._v(" "),a("li",[a("p",[s._v("exists – 存在这个值")])])])]),s._v(" "),a("li",[a("p",[s._v("（字符串查询）快捷正则查询：")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("exact – 字符串型字段完全匹配这个值")])]),s._v(" "),a("li",[a("p",[s._v("iexact – 字符串型字段完全匹配这个值（大小写敏感）")])]),s._v(" "),a("li",[a("p",[s._v("contains – 字符串字段包含这个值")])]),s._v(" "),a("li",[a("p",[s._v("icontains – 字符串字段包含这个值（大小写敏感）")])]),s._v(" "),a("li",[a("p",[s._v("startswith – 字符串字段由这个值开头")])]),s._v(" "),a("li",[a("p",[s._v("istartswith – 字符串字段由这个值开头（大小写敏感）")])]),s._v(" "),a("li",[a("p",[s._v("endswith – 字符串字段由这个值结尾")])]),s._v(" "),a("li",[a("p",[s._v("iendswith – 字符串字段由这个值结尾（大小写敏感）")])]),s._v(" "),a("li",[a("p",[s._v("match – 执行 $elemMatch 操作，所以你可以使用一个数组中的 document 实例")])])])])]),s._v(" "),a("h3",{attrs:{id:"基本使用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#基本使用"}},[s._v("#")]),s._v(" 基本使用")]),s._v(" "),a("div",{staticClass:"language-djangotemplate line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("from mongoengine import *\nfrom datetime import datetime\n# 连接数据库\nconnect('blog')   # 连接本地blog数据库\n# 如需验证和指定主机名\n# connect('blog', host='192.168.3.1', username='root', password='1234')\n\n# 定义分类文档\nclass Categories(Document):\n    ' 继承Document类,为普通文档 '\n    name = StringField(max_length=30, required=True)\n    artnum = IntField(default=0, required=True)\n    date = DateTimeField(default=datetime.now(), required=True)\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br")])]),a("p",[s._v("和Django的model使用很类似,所以也不解释什么.")]),s._v(" "),a("h3",{attrs:{id:"插入"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#插入"}},[s._v("#")]),s._v(" 插入")]),s._v(" "),a("div",{staticClass:"language-djangotemplate line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('cate = Categories(name="Linux")   # 如果required为True则必须赋予初始值,如果有default,赋予初始值则使用默认值\ncate.save() # 保存到数据库\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h3",{attrs:{id:"查询和更新"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查询和更新"}},[s._v("#")]),s._v(" 查询和更新")]),s._v(" "),a("p",[s._v("文档类有一个 objects 属性.我们使用它来查询数据库.")]),s._v(" "),a("div",{staticClass:"language-djangotemplate line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('# 返回集合里的所有文档对象的列表\ncate = Categories.objects.all()\n\n# 返回所有符合查询条件的结果的文档对象列表\ncate = Categories.objects(name="Python")\n# 更新查询到的文档:\ncate.name = "LinuxZen"\ncate.update()\n查询数组 默认查询数组"="代表的意思是in:\nclass Posts(Document):\n    artid = IntField(required=True)\n    title = StringField(max_length=100, required=True)\n    content = StringField(required=True)\n    author = ReferenceField(User)\n    tags = ListField(StringField(max_length=20, required=True), required=True)\n    categories = ReferenceField(Categories), required=True)\n    comments = IntField(default=0, required=True)\n\n# 将会返回所有tags包含coding的文档\nPosts.objects(tags=\'coding\')\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br")])]),a("h3",{attrs:{id:"referencefield-引用字段"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#referencefield-引用字段"}},[s._v("#")]),s._v(" ReferenceField 引用字段:")]),s._v(" "),a("p",[s._v("通过引用字段可以通过文档直接获取引用字段引用的那个文档:")]),s._v(" "),a("div",{staticClass:"language-djangotemplate line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("class Categories(Document):\n    name = StringField(max_length=30, required=True)\n    artnum = IntField(default=0, required=True)\n    date = DateTimeField(default=datetime.now(), required=True)\n\nclass Posts(Document):\n\n    title = StringField(max_length=100, required=True)\n    content = StringField(required=True)\n    tags = ListField(StringField(max_length=20, required=True), required=True)\n    categories = ReferenceField(Categories)\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("h3",{attrs:{id:"插入引用字段"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#插入引用字段"}},[s._v("#")]),s._v(" 插入引用字段")]),s._v(" "),a("div",{staticClass:"language-djangotemplate line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('cate =Categories(name="Linux")\ncate.save()\npost = Posts(title="Linuxzen.com", content="Linuxzen.com",tags=["Linux","web"], categories=cate)\npost.save()\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("h3",{attrs:{id:"通过引用字段直接获取引用文档对象"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#通过引用字段直接获取引用文档对象"}},[s._v("#")]),s._v(" 通过引用字段直接获取引用文档对象")]),s._v(" "),a("p",[s._v("一般文档查询会返回一个列表(尽管只有一个结果),我们想要获得一个文档对象可以使用索引获取第一个文档对象,但是mongoengine建议使用first()来获取第一个:")]),s._v(" "),a("div",{staticClass:"language-djangotemplate line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v(">>> cate = Posts.objects.all().first().categories\n>>> cate\n\n>>> cate.name\nu'Linux'\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("查询包含Linux分类的文章")]),s._v(" "),a("div",{staticClass:"language-text line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('>>> cate = Categories.objects(name="Linux").first()\n>>> Posts.objects(categories=cate)\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h3",{attrs:{id:"embeddeddocument-嵌入文档"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#embeddeddocument-嵌入文档"}},[s._v("#")]),s._v(" EmbeddedDocument 嵌入文档")]),s._v(" "),a("p",[s._v("继承EmbeddedDocument的文档类就是嵌入文档,嵌入文档用于嵌入其他文档的EmbeddedDocumentField 字段,比如上面例子的tags字段如果改成嵌入文档的话可以将Posts文档类改成如下方式:")]),s._v(" "),a("div",{staticClass:"language-djangotemplate line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("class Posts(Document):\n\n    title = StringField(max_length=100, required=True)\n    content = StringField(required=True)\n    tags = ListField(EmbeddedDocumentField('Tags')required=True)\n    categories = ReferenceField(Categories)\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[s._v("还需要添加一个Tags嵌入文档类:")]),s._v(" "),a("div",{staticClass:"language-djangotemplate line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("class Tags(EmbeddedDocument):\nname = StringField()\ndate = DateTimeField(default=datetime.now())\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("我们像如下方式插入Posts文档中的Tags")]),s._v(" "),a("div",{staticClass:"language-text line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('>>> tag = Tags(name="Linuxzen")\n>>> post = Posts(title="Linuxzen.com", content="Linuxzen.com", tags=[tag], categories=cate)\n>>> tag = Tags(name="mysite")\n>>> post.tags.append(tag)\n>>> post.save()\n>>> tags = post.tags\n>>> for tag in tags:\nprint tag.name\n\nLinuxzen\nmysite\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("h3",{attrs:{id:"时间段查询"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#时间段查询"}},[s._v("#")]),s._v(" 时间段查询")]),s._v(" "),a("div",{staticClass:"language-text line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("\n    start = datetime(int(year), int(month), 1)\n    if int(month) + 1 > 12:\n        emonth = 1\n        eyear = int(year) + 1\n    else:\n        emonth = int(month) + 1\n        eyear = int(year)\n    end = datetime(eyear, emonth, 1)\n    articles = Posts.objects(date__gte=start, date__lt=end).order_by('-date')\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("h3",{attrs:{id:"分片"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#分片"}},[s._v("#")]),s._v(" 分片")]),s._v(" "),a("p",[s._v("slice用于分片")]),s._v(" "),a("div",{staticClass:"language-text line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("# comments - skip 5, limit 10\nPage.objects.fields(slice__comments=[5, 10])\n\n# 也可以使用索引值分片\n\n# limit 5\nusers = User.objects[:5]\n\n# skip 5\nusers = User.objects[5:]\n\n# skip 10, limit 15\nusers = User.objects[10:15]\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br")])]),a("h3",{attrs:{id:"使用原始语句查询"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用原始语句查询"}},[s._v("#")]),s._v(" 使用原始语句查询")]),s._v(" "),a("p",[s._v("如果想使用原始的pymongo查询方式可以使用__raw__操作符 Page.objects(raw={'tags':'coding'}) 使用"),a("span",{staticClass:"katex"},[a("span",{staticClass:"katex-mathml"},[a("math",[a("semantics",[a("mrow",[a("mi",[s._v("i")]),a("mi",[s._v("n")]),a("mi",[s._v("c")]),a("mi",{attrs:{mathvariant:"normal"}},[s._v("和")])],1),a("annotation",{attrs:{encoding:"application/x-tex"}},[s._v("inc和")])],1)],1)],1),a("span",{staticClass:"katex-html",attrs:{"aria-hidden":"true"}},[a("span",{staticClass:"base"},[a("span",{staticClass:"strut",staticStyle:{height:"0.65952em","vertical-align":"0em"}}),a("span",{staticClass:"mord mathdefault"},[s._v("i")]),a("span",{staticClass:"mord mathdefault"},[s._v("n")]),a("span",{staticClass:"mord mathdefault"},[s._v("c")]),a("span",{staticClass:"mord cjk_fallback"},[s._v("和")])])])]),s._v("set操作符")]),s._v(" "),a("div",{staticClass:"language-djangotemplate line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('# 更新嵌入文档comments字段by的值为joe的文档字段votes增加1\nPage.objects(comments_by="joe").update(inc__votes=1)\n\n# 更新嵌入文档comments字段by的值为joe的文档字段votes设置为1\nPage.objects(comments_by="joe").update(set__votes=1)\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("h3",{attrs:{id:"其他技巧"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#其他技巧"}},[s._v("#")]),s._v(" 其他技巧")]),s._v(" "),a("div",{staticClass:"language-djangotemplate line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('#查询结果转换成字典\nusers_dict = User.objects().to_mongo()\n\n# 排序,按日期排列\nuser = User.objects.order_by("date")\n\n# 按日期倒序\n\nuser = User.objects.order_by("-date")\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])])])}),[],!1,null,null,null);e.default=n.exports}}]);