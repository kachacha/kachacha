(window.webpackJsonp=window.webpackJsonp||[]).push([[85],{242:function(s,t,a){"use strict";a.r(t);var n=a(2),e=Object(n.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("div",{staticClass:"custom-block tip"},[a("p",[s._v("前言：使用 Python 脚本发送 Kafka 一些数据以及消费相关数据方式")])]),s._v(" "),a("h2",{attrs:{id:"python脚本消费kafka数据"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#python脚本消费kafka数据"}},[s._v("#")]),s._v(" Python脚本消费kafka数据")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("\nkafka简介\n \n一、简介：\n详见：https://blog.csdn.net/Beyond_F4/article/details/80310507\n \n二、安装\n详见博客：https://blog.csdn.net/beyond_f4/article/details/80095689              \n \n三、按照官网的样例，先跑一个应用\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("、生产者:\nfrom kafka "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("import")]),s._v(" KafkaProducer\n \nproducer "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" KafkaProducer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("bootstrap_servers"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'172.21.10.136:9092'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#此处ip可以是多个['0.0.0.1:9092','0.0.0.2:9092','0.0.0.3:9092' ]")]),s._v("\n \n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token for-or-select variable"}},[s._v("i")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" range"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(":\n    msg "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"msg%d"')]),s._v(" % i\n    producer.send"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'test'")]),s._v(", msg"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nproducer.close"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n \n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("、消费者"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("简单demo"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(":\nfrom kafka "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("import")]),s._v(" KafkaConsumer\n \nconsumer "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" KafkaConsumer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'test'")]),s._v(",\n                         "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("bootstrap_servers")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'172.21.10.136:9092'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                         \n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token for-or-select variable"}},[s._v("message")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" consumer:\n    print "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"%s:%d:%d: key=%s value=%s"')]),s._v(" % "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("message.topic, message.partition,\n                                          message.offset, message.key,\n                                          message.value"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("))")]),s._v("\n \n \n启动后生产者、消费者可以正常消费。\n \n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("、消费者"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("消费群组"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nfrom kafka "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("import")]),s._v(" KafkaConsumer\n \nconsumer "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" KafkaConsumer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'test'")]),s._v(",\n                         "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("group_id")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'my-group'")]),s._v(",\n                         "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("bootstrap_servers")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'172.21.10.136:9092'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                         \n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token for-or-select variable"}},[s._v("message")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" consumer:\n    print "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"%s:%d:%d: key=%s value=%s"')]),s._v(" % "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("message.topic, message.partition,\n                                          message.offset, message.key,\n                                          message.value"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("))")]),s._v("\n                                          \n启动多个消费者，只有其中可以可以消费到，满足要求，消费组可以横向扩展提高处理能力\n \n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("、消费者"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("读取目前最早可读的消息"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nfrom kafka "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("import")]),s._v(" KafkaConsumer\n \nconsumer "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" KafkaConsumer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'test'")]),s._v(",\n                         "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("auto_offset_reset")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'earliest'")]),s._v(",\n                         "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("bootstrap_servers")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'172.21.10.136:9092'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                         \n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token for-or-select variable"}},[s._v("message")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" consumer:\n    print "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"%s:%d:%d: key=%s value=%s"')]),s._v(" % "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("message.topic, message.partition,\n                                          message.offset, message.key,\n                                          message.value"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("))")]),s._v("\n                                         \nauto_offset_reset:重置偏移量，earliest移到最早的可用消息，latest最新的消息，默认为latest\n源码定义:"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'smallest'")]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'earliest'")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'largest'")]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'latest'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n \n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("、消费者"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("手动设置偏移量"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nfrom kafka "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("import")]),s._v(" KafkaConsumer\nfrom kafka.structs "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("import")]),s._v(" TopicPartition\n \nconsumer "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" KafkaConsumer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'test'")]),s._v(",\n                         "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("bootstrap_servers")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'172.21.10.136:9092'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n \nprint consumer.partitions_for_topic"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"test"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#获取test主题的分区信息")]),s._v("\nprint consumer.topics"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#获取主题列表")]),s._v("\nprint consumer.subscription"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#获取当前消费者订阅的主题")]),s._v("\nprint consumer.assignment"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#获取当前消费者topic、分区信息")]),s._v("\nprint consumer.beginning_offsets"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("consumer.assignment"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("))")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#获取当前消费者可消费的偏移量")]),s._v("\nconsumer.seek"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("TopicPartition"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("topic"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("u"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'test'")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("partition")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#重置偏移量，从第5个偏移量消费")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token for-or-select variable"}},[s._v("message")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" consumer:\n    print "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"%s:%d:%d: key=%s value=%s"')]),s._v(" % "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("message.topic, message.partition,\n                                          message.offset, message.key,\n                                          message.value"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("))")]),s._v("\n                                          \n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v("、消费者"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("订阅多个主题"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nfrom kafka "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("import")]),s._v(" KafkaConsumer\nfrom kafka.structs "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("import")]),s._v(" TopicPartition\n \nconsumer "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" KafkaConsumer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("bootstrap_servers"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'172.21.10.136:9092'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nconsumer.subscribe"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("topics"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'test'")]),s._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'test0'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("))")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#订阅要消费的主题")]),s._v("\nprint consumer.topics"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nprint consumer.position"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("TopicPartition"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("topic"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("u"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'test'")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("partition")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("))")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#获取当前主题的最新偏移量")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token for-or-select variable"}},[s._v("message")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" consumer:\n    print "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"%s:%d:%d: key=%s value=%s"')]),s._v(" % "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("message.topic, message.partition,\n                                          message.offset, message.key,\n                                          message.value"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("))")]),s._v("\n                                          \n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v("、消费者"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("手动拉取消息"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nfrom kafka "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("import")]),s._v(" KafkaConsumer\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("import")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("time")]),s._v("\n \nconsumer "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" KafkaConsumer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("bootstrap_servers"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'172.21.10.136:9092'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nconsumer.subscribe"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("topics"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'test'")]),s._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'test0'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("))")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("while")]),s._v(" True:\n    msg "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" consumer.poll"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("timeout_ms"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#从kafka获取消息")]),s._v("\n    print msg\n    time.sleep"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    \n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v("、消费者"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("消息挂起与恢复"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nfrom kafka "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("import")]),s._v(" KafkaConsumer\nfrom kafka.structs "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("import")]),s._v(" TopicPartition\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("import")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("time")]),s._v("\n \nconsumer "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" KafkaConsumer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("bootstrap_servers"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'172.21.10.136:9092'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nconsumer.subscribe"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("topics"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'test'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("))")]),s._v("\nconsumer.topics"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nconsumer.pause"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("TopicPartition"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("topic"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("u"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'test'")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("partition")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("))")]),s._v("\nnum "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("while")]),s._v(" True:\n    print num\n    print consumer.paused"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#获取当前挂起的消费者")]),s._v("\n    msg "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" consumer.poll"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("timeout_ms"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    print msg\n    time.sleep"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    num "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" num + "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" num "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(":\n        print "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"resume..."')]),s._v("\n        consumer.resume"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("TopicPartition"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("topic"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("u"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'test'")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("partition")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("))")]),s._v("\n        print "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"resume......"')]),s._v("\n        \npause执行后，consumer不能读取，直到调用resume后恢复。\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br"),a("span",{staticClass:"line-number"},[s._v("52")]),a("br"),a("span",{staticClass:"line-number"},[s._v("53")]),a("br"),a("span",{staticClass:"line-number"},[s._v("54")]),a("br"),a("span",{staticClass:"line-number"},[s._v("55")]),a("br"),a("span",{staticClass:"line-number"},[s._v("56")]),a("br"),a("span",{staticClass:"line-number"},[s._v("57")]),a("br"),a("span",{staticClass:"line-number"},[s._v("58")]),a("br"),a("span",{staticClass:"line-number"},[s._v("59")]),a("br"),a("span",{staticClass:"line-number"},[s._v("60")]),a("br"),a("span",{staticClass:"line-number"},[s._v("61")]),a("br"),a("span",{staticClass:"line-number"},[s._v("62")]),a("br"),a("span",{staticClass:"line-number"},[s._v("63")]),a("br"),a("span",{staticClass:"line-number"},[s._v("64")]),a("br"),a("span",{staticClass:"line-number"},[s._v("65")]),a("br"),a("span",{staticClass:"line-number"},[s._v("66")]),a("br"),a("span",{staticClass:"line-number"},[s._v("67")]),a("br"),a("span",{staticClass:"line-number"},[s._v("68")]),a("br"),a("span",{staticClass:"line-number"},[s._v("69")]),a("br"),a("span",{staticClass:"line-number"},[s._v("70")]),a("br"),a("span",{staticClass:"line-number"},[s._v("71")]),a("br"),a("span",{staticClass:"line-number"},[s._v("72")]),a("br"),a("span",{staticClass:"line-number"},[s._v("73")]),a("br"),a("span",{staticClass:"line-number"},[s._v("74")]),a("br"),a("span",{staticClass:"line-number"},[s._v("75")]),a("br"),a("span",{staticClass:"line-number"},[s._v("76")]),a("br"),a("span",{staticClass:"line-number"},[s._v("77")]),a("br"),a("span",{staticClass:"line-number"},[s._v("78")]),a("br"),a("span",{staticClass:"line-number"},[s._v("79")]),a("br"),a("span",{staticClass:"line-number"},[s._v("80")]),a("br"),a("span",{staticClass:"line-number"},[s._v("81")]),a("br"),a("span",{staticClass:"line-number"},[s._v("82")]),a("br"),a("span",{staticClass:"line-number"},[s._v("83")]),a("br"),a("span",{staticClass:"line-number"},[s._v("84")]),a("br"),a("span",{staticClass:"line-number"},[s._v("85")]),a("br"),a("span",{staticClass:"line-number"},[s._v("86")]),a("br"),a("span",{staticClass:"line-number"},[s._v("87")]),a("br"),a("span",{staticClass:"line-number"},[s._v("88")]),a("br"),a("span",{staticClass:"line-number"},[s._v("89")]),a("br"),a("span",{staticClass:"line-number"},[s._v("90")]),a("br"),a("span",{staticClass:"line-number"},[s._v("91")]),a("br"),a("span",{staticClass:"line-number"},[s._v("92")]),a("br"),a("span",{staticClass:"line-number"},[s._v("93")]),a("br"),a("span",{staticClass:"line-number"},[s._v("94")]),a("br"),a("span",{staticClass:"line-number"},[s._v("95")]),a("br"),a("span",{staticClass:"line-number"},[s._v("96")]),a("br"),a("span",{staticClass:"line-number"},[s._v("97")]),a("br"),a("span",{staticClass:"line-number"},[s._v("98")]),a("br"),a("span",{staticClass:"line-number"},[s._v("99")]),a("br"),a("span",{staticClass:"line-number"},[s._v("100")]),a("br"),a("span",{staticClass:"line-number"},[s._v("101")]),a("br"),a("span",{staticClass:"line-number"},[s._v("102")]),a("br"),a("span",{staticClass:"line-number"},[s._v("103")]),a("br"),a("span",{staticClass:"line-number"},[s._v("104")]),a("br"),a("span",{staticClass:"line-number"},[s._v("105")]),a("br"),a("span",{staticClass:"line-number"},[s._v("106")]),a("br"),a("span",{staticClass:"line-number"},[s._v("107")]),a("br"),a("span",{staticClass:"line-number"},[s._v("108")]),a("br"),a("span",{staticClass:"line-number"},[s._v("109")]),a("br"),a("span",{staticClass:"line-number"},[s._v("110")]),a("br"),a("span",{staticClass:"line-number"},[s._v("111")]),a("br"),a("span",{staticClass:"line-number"},[s._v("112")]),a("br"),a("span",{staticClass:"line-number"},[s._v("113")]),a("br"),a("span",{staticClass:"line-number"},[s._v("114")]),a("br"),a("span",{staticClass:"line-number"},[s._v("115")]),a("br"),a("span",{staticClass:"line-number"},[s._v("116")]),a("br"),a("span",{staticClass:"line-number"},[s._v("117")]),a("br"),a("span",{staticClass:"line-number"},[s._v("118")]),a("br"),a("span",{staticClass:"line-number"},[s._v("119")]),a("br"),a("span",{staticClass:"line-number"},[s._v("120")]),a("br"),a("span",{staticClass:"line-number"},[s._v("121")]),a("br"),a("span",{staticClass:"line-number"},[s._v("122")]),a("br"),a("span",{staticClass:"line-number"},[s._v("123")]),a("br"),a("span",{staticClass:"line-number"},[s._v("124")]),a("br"),a("span",{staticClass:"line-number"},[s._v("125")]),a("br"),a("span",{staticClass:"line-number"},[s._v("126")]),a("br"),a("span",{staticClass:"line-number"},[s._v("127")]),a("br"),a("span",{staticClass:"line-number"},[s._v("128")]),a("br"),a("span",{staticClass:"line-number"},[s._v("129")]),a("br")])])])}),[],!1,null,null,null);t.default=e.exports}}]);