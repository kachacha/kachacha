(window.webpackJsonp=window.webpackJsonp||[]).push([[17],{277:function(s,t,a){"use strict";a.r(t);var n=a(2),e=Object(n.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("div",{staticClass:"custom-block tip"},[a("p",[s._v("前言：编写完一个项目不可能一直将一个项目长久单机运行；所以此文介绍将一个项目部署到 Opebshift 中所需要的文件以及其配置。")])]),s._v(" "),a("h1",{attrs:{id:"openshift-s2i"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#openshift-s2i"}},[s._v("#")]),s._v(" Openshift S2I")]),s._v(" "),a("h2",{attrs:{id:"环境："}},[a("a",{staticClass:"header-anchor",attrs:{href:"#环境："}},[s._v("#")]),s._v(" 环境：")]),s._v(" "),a("p",[s._v("含有 "),a("code",[s._v("oc")]),s._v(" 命令")]),s._v(" "),a("h2",{attrs:{id:"第一次构建步骤："}},[a("a",{staticClass:"header-anchor",attrs:{href:"#第一次构建步骤："}},[s._v("#")]),s._v(" 第一次构建步骤：")]),s._v(" "),a("ul",[a("li",[s._v("修改 "),a("code",[s._v("Dockerfile")]),s._v(" 文件")]),s._v(" "),a("li",[s._v("修改 "),a("code",[s._v("Makefile")]),s._v(" 文件")]),s._v(" "),a("li",[s._v("修改 "),a("code",[s._v("gitlab-ci.yaml")]),s._v(" 文件")]),s._v(" "),a("li",[s._v("上传项目至 "),a("code",[s._v("Gitlab")]),s._v(" （仅将代码推送至 "),a("code",[s._v("Gitlab")]),s._v("）")]),s._v(" "),a("li",[s._v("运行 "),a("code",[s._v("make deploy")])])]),s._v(" "),a("h3",{attrs:{id:"第一步：修改-dockerfile-文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#第一步：修改-dockerfile-文件"}},[s._v("#")]),s._v(" 第一步：修改 "),a("code",[s._v("Dockerfile")]),s._v(" 文件")]),s._v(" "),a("blockquote",[a("p",[s._v("修改下列有注释的值：")])]),s._v(" "),a("blockquote",[a("blockquote",[a("p",[s._v("详细介绍看下文")])])]),s._v(" "),a("div",{staticClass:"language-Dockerfile line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('FROM alpine:3.8-python-3.6\n\nLABEL io.k8s.description="Flask Demo" \\                  # 此标签是对Docker的描述简介\n    io.openshift.expose-services="8000:http" \\           # 此标签包含与*Dockerfile*中的 EXPOSE 指令匹配的服务端口列表\n    io.openshift.tags="builder,rest,demo,flask" \\        # 此标签包含一个标记列表，表示为逗号分隔的字符串值列表\n    io.openshift.min-memory=1Gi \\                        # （可不添加）此标签表明Docker镜像可能需要多少内存资源\n    io.openshift.min-cpu=4                               # （可不添加）此标签表明Docker镜像可能需要多少CPU资源\n\nWORKDIR /opt/app\nENV HOME /opt/app\nADD . /opt/app\n\nRUN pip3.6 install -r requirements.txt --upgrade --index-url https://mirrors.tuna.tsinghua.edu.cn/pypi/web/simple \\\n    && chown -R 1001:0 /opt/app && chmod -R 777 /opt/app\n\nEXPOSE 8000                                              # 暴露的服务端口\n\nENTRYPOINT ["gunicorn"]\nCMD ["-b 0.0.0.0:8000", "application:app"]\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br")])]),a("h6",{attrs:{id:"io-k8s-description"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#io-k8s-description"}},[s._v("#")]),s._v(" io.k8s.description")]),s._v(" "),a("p",[s._v("此标签可用于为Docker镜像消费者提供有关此图像提供的服务或功能的更详细信息。 然后，UI可以将此描述与Docker图像名称一起使用，以向最终用户提供更加人性化的信息。")]),s._v(" "),a("p",[a("strong",[s._v("样例")])]),s._v(" "),a("div",{staticClass:"language-text line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('LABEL io.k8s.description="Flask Demo"\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h6",{attrs:{id:"io-openshift-expose-services"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#io-openshift-expose-services"}},[s._v("#")]),s._v(" io.openshift.expose-services")]),s._v(" "),a("p",[s._v("此标签包含与* Dockerfile *中的EXPOSE指令匹配的服务端口列表，并提供有关给定端口上的实际服务提供给消费者的更多描述性信息。")]),s._v(" "),a("p",[s._v("格式为 "),a("code",[s._v("PORT[/PROTO]:NAME")]),s._v("，其中 "),a("code",[s._v("[PROTO]")]),s._v(" 部分是可选的，如果未指定，则默认为 "),a("code",[s._v("tcp")]),s._v("。")]),s._v(" "),a("p",[a("strong",[s._v("样例")])]),s._v(" "),a("div",{staticClass:"language-text line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('LABEL io.openshift.expose-services="8000:http,8080:https"\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h6",{attrs:{id:"io-openshift-tags"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#io-openshift-tags"}},[s._v("#")]),s._v(" io.openshift.tags")]),s._v(" "),a("p",[s._v("此标签包含一个标记列表，表示为逗号分隔的字符串值列表。 标签是将Docker镜像分类为广泛功能区域的方法。 标签可帮助UI和生成工具在应用程序创建过程中建议相关的Docker镜像。")]),s._v(" "),a("p",[a("strong",[s._v("样例")])]),s._v(" "),a("div",{staticClass:"language-text line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('LABEL io.openshift.tags="builder,rest,demo,flask"\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h6",{attrs:{id:"io-openshift-min-memory-io-openshift-min-cpu"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#io-openshift-min-memory-io-openshift-min-cpu"}},[s._v("#")]),s._v(" io.openshift.min-memory & io.openshift.min-cpu")]),s._v(" "),a("p",[s._v("此标签表明Docker镜像可能需要多少资源才能正常工作。 UI可能会警告用户部署此Docker镜像可能会超出其用户配额。 这些值必须与Kubernetes数量兼容。")]),s._v(" "),a("p",[a("strong",[s._v("样例")])]),s._v(" "),a("div",{staticClass:"language-text line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('LABEL io.openshift.min-memory="1Gi"\nLABEL io.openshift.min-cpu="4"\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h3",{attrs:{id:"第二步：修改-makefile-文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#第二步：修改-makefile-文件"}},[s._v("#")]),s._v(" 第二步：修改 "),a("code",[s._v("Makefile")]),s._v(" 文件")]),s._v(" "),a("blockquote",[a("p",[s._v("修改下列有注释的值：")])]),s._v(" "),a("blockquote",[a("blockquote",[a("p",[s._v("详细介绍看下文")])])]),s._v(" "),a("div",{staticClass:"language-Makefile line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-makefile"}},[a("code",[s._v("IMAGE"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("registry.sinocbd.local/rtod-3/flask-demo"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("latest                   "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 镜像推到Docker仓库的地址和名称以及标签")]),s._v("\nGITLAB_URL"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("http"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("//gitlab.sinocbd.local/shitao/flask-demo.git"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#master     # 项目在 Gitlab 上的地址及分支")]),s._v("\nPROJECT_NAME"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("flask-demo                                                 "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 项目在 OpenShift 上生成的 Application 名称")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v(".PHONY")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" build push test deploy destroy start-build\n\n"),a("span",{pre:!0,attrs:{class:"token symbol"}},[s._v("build")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n\tdocker-compose build --no-cache\n\n"),a("span",{pre:!0,attrs:{class:"token symbol"}},[s._v("push")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" build\n\tdocker push "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("IMAGE"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token symbol"}},[s._v("test")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n\tvenv/bin/pytest --cov"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("app tests/  --cov-report"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("html                 "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 需要测试的代码和测试代码目录")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token symbol"}},[s._v("deploy")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n\toc new-app "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("GITLAB_URL"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" --allow-missing-images"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("true\n\n"),a("span",{pre:!0,attrs:{class:"token symbol"}},[s._v("destroy")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n\toc delete all -l app"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("PROJECT_NAME"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token symbol"}},[s._v("start-build")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n\toc start-build bc/"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("PROJECT_NAME"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br")])]),a("h6",{attrs:{id:"镜像名称（image）"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#镜像名称（image）"}},[s._v("#")]),s._v(" 镜像名称（IMAGE）")]),s._v(" "),a("p",[s._v("推到docker仓库的地址")]),s._v(" "),a("h6",{attrs:{id:"项目地址（project-url）"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#项目地址（project-url）"}},[s._v("#")]),s._v(" 项目地址（PROJECT_URL）")]),s._v(" "),a("p",[s._v("项目在Gitlab的地址，采用 "),a("code",[s._v("HTTP")]),s._v(" 的形似，"),a("code",[s._v("#")]),s._v(" 后面所表示的是分支")]),s._v(" "),a("h6",{attrs:{id:"镜像名称（project-name）"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#镜像名称（project-name）"}},[s._v("#")]),s._v(" 镜像名称（PROJECT_NAME）")]),s._v(" "),a("p",[s._v("运行完 "),a("code",[s._v("make deploy")]),s._v(" 后，在 "),a("code",[s._v("OpenShift")]),s._v(" 上生成的 "),a("code",[s._v("Application")]),s._v(" 名称")]),s._v(" "),a("h6",{attrs:{id:"测试"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#测试"}},[s._v("#")]),s._v(" 测试")]),s._v(" "),a("div",{staticClass:"language-text line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("venv/bin/pytest --cov=app tests/  --cov-report=html\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("code",[s._v("venv/bin/pytest")]),s._v(" 是在有 "),a("code",[s._v("env")]),s._v(" 环境下的运行方法，如果没有 "),a("code",[s._v("venv")]),s._v(" 则直接使用 "),a("code",[s._v("pytest")]),s._v(" 请根据实际情况修改\n"),a("code",[s._v("--cov=app")]),s._v(" 其中的 "),a("code",[s._v("app")]),s._v(" 表示的是需要被测试的源代码 请根据实际情况修改\n"),a("code",[s._v("tests/")]),s._v(" 表示的是测试代码存放的位置 请根据实际情况修改")]),s._v(" "),a("h3",{attrs:{id:"第三步：修改-gitlab-ci-yaml-文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#第三步：修改-gitlab-ci-yaml-文件"}},[s._v("#")]),s._v(" 第三步：修改 "),a("code",[s._v("gitlab-ci.yaml")]),s._v(" 文件")]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("variables")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("OSC_USERNAME")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" admin                                                    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# OpenShift的用户名")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("OSC_PASSWORD")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" admin                                                    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# OpenShift的密码")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("OSC_PROJECT")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" shitao                                                    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# OpenShift 的命名空间（即项目部署到OpenShift的空间）")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("PROJECT_NAME")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" flask"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("demo                                               "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 项目在 OpenShift 的 Application 名称")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("GITLAB_URL")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" http"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("//gitlab.sinocbd.local/shitao/flask"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("demo.git"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#master   # 项目在 Gitlab 上的地址及分支")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("stages")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" test\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" pages\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" build\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("before_script")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" pip3 install "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("user pytest pytest"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("cov "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("upgrade "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("index"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("url https"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("//pypi.tuna.tsinghua.edu.cn/simple\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("test")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("stage")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" test\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("script")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" pytest "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("cov=app tests/                                              "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 需要测试的代码和测试代码目录")]),s._v("\n\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("pages")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("stage")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" pages\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("script")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" pip3.6 install "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("r requirements.txt "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("upgrade "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("index"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("url https"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("//mirrors.tuna.tsinghua.edu.cn/pypi/web/simple "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("user\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" cd docs\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" make html\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" cp "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("R ./_build/html ../public\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("artifacts")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("paths")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" public\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("build")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("stage")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" build\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("script")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" oc login https"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("//stack"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("1.sinocbd.local"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("8443 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("username=$"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("OSC_USERNAME"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("password=$"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("OSC_PASSWORD"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" oc project $"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("OSC_PROJECT"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" oc start"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("build bc/$"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("PROJECT_NAME"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br")])]),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("stages")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" edge\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" release\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("edge")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("stage")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" edge\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("script")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" OCP_PROJECT=idsg"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("edge ocp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("build\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("only")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"dev"')]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("release")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("stage")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" release\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("script")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" OCP_PROJECT=idsg ocp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("build\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("only")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"master"')]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br")])]),a("h6",{attrs:{id:"osc-username"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#osc-username"}},[s._v("#")]),s._v(" OSC_USERNAME")]),s._v(" "),a("p",[s._v("OpenShift 的用户名")]),s._v(" "),a("h6",{attrs:{id:"osc-password"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#osc-password"}},[s._v("#")]),s._v(" OSC_PASSWORD")]),s._v(" "),a("p",[s._v("OpenShift 的密码")]),s._v(" "),a("h6",{attrs:{id:"osc-project"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#osc-project"}},[s._v("#")]),s._v(" OSC_PROJECT")]),s._v(" "),a("p",[s._v("OpenShift 的 "),a("code",[s._v("namespace")])]),s._v(" "),a("h6",{attrs:{id:"project-name"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#project-name"}},[s._v("#")]),s._v(" PROJECT_NAME")]),s._v(" "),a("p",[s._v("运行完 "),a("code",[s._v("make deploy")]),s._v(" 后，在 "),a("code",[s._v("OpenShift")]),s._v(" 上生成的 "),a("code",[s._v("Application")]),s._v(" 名称")]),s._v(" "),a("h6",{attrs:{id:"gitlab-url"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#gitlab-url"}},[s._v("#")]),s._v(" GITLAB_URL")]),s._v(" "),a("p",[s._v("项目在 "),a("code",[s._v("Gitlab")]),s._v(" 的地址，采用 "),a("code",[s._v("HTTP")]),s._v(" 的形似，"),a("code",[s._v("#")]),s._v(" 后面所表示的是分支")]),s._v(" "),a("h6",{attrs:{id:"测试-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#测试-2"}},[s._v("#")]),s._v(" 测试")]),s._v(" "),a("div",{staticClass:"language-text line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("pytest --cov=app tests/\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("blockquote",[a("p",[s._v("内容与 "),a("code",[s._v("Makefile")]),s._v(" 一致")])]),s._v(" "),a("p",[a("code",[s._v("--cov=app")]),s._v(" 其中的 "),a("code",[s._v("app")]),s._v(" 表示的是需要被测试的源代码 请根据实际情况修改\n"),a("code",[s._v("tests/")]),s._v(" 表示的是测试代码存放的位置 请根据实际情况修改")]),s._v(" "),a("h3",{attrs:{id:"第四步：上传项目"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#第四步：上传项目"}},[s._v("#")]),s._v(" 第四步：上传项目")]),s._v(" "),a("p",[s._v("将修改后的项目上传到 "),a("code",[s._v("Gitlab")])]),s._v(" "),a("h3",{attrs:{id:"第五步：运行-make-deploy"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#第五步：运行-make-deploy"}},[s._v("#")]),s._v(" 第五步：运行 "),a("code",[s._v("make deploy")])]),s._v(" "),a("ol",[a("li",[s._v("使用 OC 命名登陆")]),s._v(" "),a("li",[s._v("切换到对应的 "),a("code",[s._v("namespace")])]),s._v(" "),a("li",[s._v("运行 "),a("code",[s._v("make deploy")]),s._v(" 来第一次构建项目到 "),a("code",[s._v("OpenShift")]),s._v(" 上")])]),s._v(" "),a("h2",{attrs:{id:"以后的部署"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#以后的部署"}},[s._v("#")]),s._v(" 以后的部署")]),s._v(" "),a("h6",{attrs:{id:"方式一"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#方式一"}},[s._v("#")]),s._v(" 方式一")]),s._v(" "),a("p",[s._v("直接上传项目就会自动构建")]),s._v(" "),a("h5",{attrs:{id:"方式二"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#方式二"}},[s._v("#")]),s._v(" 方式二")]),s._v(" "),a("p",[s._v("将代码推到 "),a("code",[s._v("Gitlab")]),s._v(" 上后，运行 "),a("code",[s._v("make start-build")])]),s._v(" "),a("h2",{attrs:{id:"续。。"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#续。。"}},[s._v("#")]),s._v(" 续。。")]),s._v(" "),a("blockquote",[a("p",[a("code",[s._v("docker-compose.yaml")]),s._v(" 的编写实例")])]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("version")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"3"')]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("services")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("tools")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("build")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("context")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" .\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" registry.zylliondata.local/idsg/system"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("basic"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("page"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("1.1.0\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ports")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" 8080"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("version")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"3"')]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("services")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("scoring-system")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("build")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("context")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" .\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("container_name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" scoring"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("system\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" registry.zylliondata.local/idsg/scoring"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("system"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("1.1.0\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("restart")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" always\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ports")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" 5000"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5000")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])])])}),[],!1,null,null,null);t.default=e.exports}}]);